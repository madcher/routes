{"version":3,"sources":["components/Header.js","components/Info.js","components/MapComponent.js","icons/aim.js","serviceWorker.js","services/service.js","consts.js","components/AddpointComponent.js","components/Content.js","components/Auth.js","App.js","index.js"],"names":["Header","setToken","className","onClick","Info","point","carid","Date","datetime","toLocaleString","L","Icon","Default","imagePath","MapComponent","state","setMap","points","center","lat","lng","MapContainer","zoom","whenCreated","TileLayer","url","map","Marker","position","Popup","Aim","id","enable-background","height","viewBox","width","fill","xmlns","d","workerFunction","this","onmessage","data","wsConnection","WebSocket","onopen","postMessage","hint","onclose","event","wasClean","code","reason","evt","message","onerror","error","getPoints","setPoints","token","fetch","method","headers","then","response","json","catch","err","console","log","initialMapState","CENTER","AddPointComponent","callback","onSubmit","e","preventDefault","FormData","target","get","carId","alert","type","placeholder","name","Content","useState","useEffect","length","lastPoint","lastCoord","flyTo","socketMessageHandler","blob","Blob","replace","blobURL","window","URL","webkitURL","createObjectURL","myWorker","Worker","addThis","num1","num2","initWebSocket","query","body","JSON","stringify","res","addPoint","Auth","setError","login","password","ok","status","Error","result","loginFunc","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.41384c2a.chunk.js","sourcesContent":["import React from 'react';\n// шапка страницы\nconst Header = ({setToken}) => {\n    return (\n        <div className=\"header\">\n            <div className=\"header__label\">Route Tracker</div>\n            <div><button className=\"header__logout\" onClick={() => setToken(false)}>Log out</button></div>\n        </div>\n    );\n}\n\nexport default Header;","import React, {useState} from 'react';\n\nconst Info = ({point}) => {\n\n    return (\n        <div>\n            <div>{`Номер: ${point.carid}`}</div>\n            <div>{`Время: ${new Date(point.datetime).toLocaleString()}`}</div>\n        </div>\n    )\n}\n\nexport default Info;","import React, {useState} from 'react';\nimport Info from './Info';\nimport { MapContainer, TileLayer, Marker, Popup } from \"react-leaflet\";\nimport L from 'leaflet';\nimport './map.css';\n\n// указываем путь к файлам marker\nL.Icon.Default.imagePath = \"https://unpkg.com/leaflet@1.5.0/dist/images/\";\n\n\n\nconst MapComponent = ({state, setMap, points}) => {\n    \n\n    const center = [state.lat, state.lng];\n\n    return (\n        <MapContainer\n            zoom={state.zoom}\n            center={center}\n            whenCreated={setMap}\n        >\n            <TileLayer\n                url='https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png'\n            />\n            {\n                points.map(point => {\n                    return (\n                        <Marker position={[point.lat, point.lng]} key={point.datetime}>\n                            <Popup>\n                                <Info point={point} />\n                            </Popup>\n                        </Marker>\n                    );\n                })\n            }\n        </MapContainer>\n    );\n};\n\nexport default MapComponent;","\nimport React from 'react';\nconst Aim = () => {\n    return (\n        <svg\n            id=\"regular\"\n            enable-background=\"new 0 0 24 24\"\n            height=\"24\"\n            viewBox=\"0 0 24 24\"\n            width=\"24\"\n            fill=\"#6b7070\"\n            xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"m12 22c-5.514 0-10-4.486-10-10s4.486-10 10-10 10 4.486 10 10-4.486 10-10 10zm0-18.5c-4.687 0-8.5 3.813-8.5 8.5s3.813 8.5 8.5 8.5 8.5-3.813 8.5-8.5-3.813-8.5-8.5-8.5z\"/>\n                <path d=\"m12 5c-.414 0-.75-.336-.75-.75v-3.5c0-.414.336-.75.75-.75s.75.336.75.75v3.5c0 .414-.336.75-.75.75z\"/>\n                <path d=\"m23.25 12.75h-3.5c-.414 0-.75-.336-.75-.75s.336-.75.75-.75h3.5c.414 0 .75.336.75.75s-.336.75-.75.75z\"/>\n                <path d=\"m12 24c-.414 0-.75-.336-.75-.75v-3.5c0-.414.336-.75.75-.75s.75.336.75.75v3.5c0 .414-.336.75-.75.75z\"/>\n                <path d=\"m4.25 12.75h-3.5c-.414 0-.75-.336-.75-.75s.336-.75.75-.75h3.5c.414 0 .75.336.75.75s-.336.75-.75.75z\"/>\n                <path d=\"m12 15c-1.654 0-3-1.346-3-3s1.346-3 3-3 3 1.346 3 3-1.346 3-3 3zm0-4.5c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5 1.5-.673 1.5-1.5-.673-1.5-1.5-1.5z\"/>\n        </svg>\n    );\n};\nexport default Aim;","function workerFunction() {\n    var self = this;\n    self.onmessage = function({data}) {\n        const wsConnection = new WebSocket(\"ws://localhost:8888\");\n    \n        // web socket\n        wsConnection.onopen = function() {\n            postMessage({hint: 'Соединение установлено'});\n        };\n    \n        wsConnection.onclose = function(event) {\n            if (event.wasClean) {\n                postMessage({hint: 'Соединение закрыто чисто'});\n            } else {\n                // например, \"убит\" процесс сервера\n                postMessage({hint: 'Обрыв соединения'});\n            }\n            postMessage({hint: 'Код: ' + event.code + ' причина: ' + event.reason});\n        };\n    \n        wsConnection.onmessage = evt => {\n            // отправляем сообщение в основной поток\n            postMessage({message: evt.data});\n        }\n    \n        wsConnection.onerror = function(error) {\n            postMessage({error: \"Ошибка \" + error.message});\n        };\n    }\n}\n\nexport default workerFunction;\n\n\n\n\n\n","import workerFunction from '../serviceWorker';\n\n// функция авторизации\nexport const loginFunc = (e, setToken, setError) => {\n    const data = new FormData(e.target);\n    const login = data.get('login');\n    const password = data.get('password');\n    console.log(login, password);\n    fetch('/api/authorization', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json;charset=utf-8'\n        },\n        body: JSON.stringify({ login, password }),\n    }).then(res => {\n        if (!res.ok) {\n            console.log(\"HTTP status \" + res.status);\n            throw Error;\n        }\n        return res.json();\n    }).then(result => {\n        setToken(result.token);\n        setError(false);\n    }).catch(err => {\n        setError(true);\n        console.log(err)\n    });\n};\n\n// получение маршрутов\nexport const getPoints = (setPoints, token) => {\n    fetch('/api/get', {\n        method: 'GET',\n        headers: {'token': token}\n    }).then(response => response.json()).then(data => {\n        setPoints(data);\n    }).catch(err => console.log(err));\n}\n// добавление точки\nexport const addPoint = (query, setPoints, token) => {\n    fetch('/api/addpoint', {\n        method: 'POST',\n        headers: {'token': token, 'Content-Type': 'application/json;charset=utf-8'},\n        body: JSON.stringify(query)\n    }).then(res => {\n        getPoints(setPoints, token);\n    }).catch(err => console.log(err));\n}\n\nexport const initWebSocket = (callback) => {\n    var dataObj = '(' + workerFunction + ')();'; // here is the trick to convert the above fucntion to string\n    var blob = new Blob([dataObj.replace('\"use strict\";', '')]); // firefox adds \"use strict\"; to any function which might block worker execution so knock it off\n\n    var blobURL = (window.URL ? window.URL : window.webkitURL).createObjectURL(blob, {\n        type: 'application/javascript; charset=utf-8'\n    });\n\n    const myWorker = new Worker(blobURL);\n    //const myWorker = new Worker('serviceWorker.js');\n    const message = { addThis: {num1: 1, num2: 10} };\n    myWorker.postMessage(message);\n    myWorker.onmessage = ({data}) => {\n        const {error, hint, message} = data;\n        if (error) {\n            alert(error);\n        }\n\n        if (message) {\n            console.log(message);\n            callback();\n        }\n    }\n};","export const  initialMapState = {\n    lat: 55.702868,\n    lng: 37.530865,\n    zoom: 10\n};\n\nexport const CENTER = [55.702868, 37.530865 ];\nexport const INITZOOM = 10;","import React from 'react';\n\n\n\nconst AddPointComponent = ({callback}) => {\n    const addPointHandler = (e) => {\n        e.preventDefault();\n        const data = new FormData(e.target);\n        const lat = data.get('lat');\n        const lng = data.get('lng');\n        const carId = data.get('uid');\n        if (!lng || !lat || !carId) {\n            alert('add all fields');\n            return;\n        }\n        callback({lat, lng, carId});\n    };\n\n    return (\n        <div className=\"map-menu\">\n            <form onSubmit={addPointHandler} className=\"addpoint-form\">\n                <label className=\"auth__label\">Uid</label>\n                <input className=\"auth__input\" type=\"text\" placeholder=\"\" name=\"uid\"/>\n                <label className=\"auth__label\">Latitude</label>\n                <input className=\"auth__input\" type=\"text\" placeholder=\"\" name=\"lat\"/>\n                <label className=\"auth__label\">Longitude</label>\n                <input className=\"auth__input\" type=\"text\" placeholder=\"\" name=\"lng\"/>\n                <button type=\"submit\" className=\"auth__input auth_button\">Add</button>\n            </form>\n        </div>\n    )\n}\n\n\nexport default AddPointComponent;","import React, {useEffect, useState, useRef } from 'react';\nimport MapComponent from './MapComponent';\nimport Aim from '../icons/aim'\nimport { addPoint, initWebSocket, getPoints } from '../services/service';\nimport { initialMapState, CENTER, INITZOOM } from '../consts';\nimport AddPointComponent from './AddpointComponent'\n\n\n// содержания страницы\nconst Content = ({token}) => {\n    const [state, setState] = useState(initialMapState);\n    const [ map, setMap ] = useState(null);\n    const [points, setPoints] = useState([]);\n    \n    useEffect(() => {\n        getPoints(setPoints, token)\n    }, []);\n\n    useEffect(() => {\n        if (!points.length) {\n            return;\n        }\n        const lastPoint = points[points.length-1];\n        const lastCoord = [lastPoint.lat, lastPoint.lng];\n        map.flyTo(lastCoord, INITZOOM);\n    }, [points]);\n\n    const socketMessageHandler = () => {\n        console.log('ssss');\n        getPoints(setPoints, token);\n    }\n    \n    // worker\n    useEffect(() => {\n        initWebSocket(socketMessageHandler);\n    }, []);\n\n    const goToCenter = () => {\n        map.flyTo(CENTER, INITZOOM);\n    }\n\n    const addPointHandler = (data) => {\n        addPoint(data, setPoints, token);\n    };\n    \n    return (\n        <div className=\"content\">\n            <AddPointComponent callback={addPointHandler} />\n            <div className=\"center-menu\">\n                <div><Aim/></div>\n                <div>\n                    <button type=\"button\" className=\"auth__input auth_button\" onClick={goToCenter}>go</button>\n                </div>\n            </div>\n            <div id=\"mapid\">\n                <MapComponent state={state} setMap={setMap} points={points}/>\n            </div>\n        </div>\n    );\n}\n\nexport default Content;","// страница авторизации\nimport React, {useEffect, useState} from 'react';\nimport { loginFunc } from '../services/service';\n\nconst Auth = ({setToken}) => {\nconst [error, setError] = useState(false);\nconst submitHandler = (e) => {\n    e.preventDefault();\n    loginFunc(e, setToken, setError)\n};\n\nreturn(<div className=\"auth__container\">\n        <form className=\"auth__form\" onSubmit={submitHandler}>\n            <label className=\"auth__label\">Login</label>\n            <input className=\"auth__input\" type=\"text\" placeholder=\"login\" name=\"login\"/>\n            <label className=\"auth__label\">Password</label>\n            <input className=\"auth__input\" type=\"password\" placeholder=\"\" name=\"password\"/>\n            {error && <div className=\"auth_error\">Invalid login or password</div>}\n            <button type=\"submit\" className=\"auth__input auth_button\">Submit</button>\n        </form>\n    </div>);\n}\n\nexport default Auth;","import React, { useState } from 'react';\nimport Header from './components/Header';\nimport Content from './components/Content';\nimport Auth from './components/Auth';\n\n// компонент приложения\nconst App = () => {\n    const [token, setToken] = useState(null);\n    if (!token) {\n        return (<Auth setToken={setToken} />)\n    }\n    return(<div>\n            <Header setToken={setToken}/>\n            <Content token={token}/>\n        </div>);\n}\n\nexport default App;\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}