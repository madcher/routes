{"version":3,"sources":["components/Header.js","components/Info.js","icons/car.png","icons/truck.png","icons/circle.svg","consts.js","components/MapComponent.js","icons/aim.js","serviceWorker.js","services/service.js","components/AddpointComponent.js","components/TableRoutes.js","components/Content.js","components/Auth.js","App.js","index.js"],"names":["Header","setToken","route","setRoute","menuHandler","e","menuId","currentTarget","id","className","type","value","onClick","style","textDecoration","Info","point","carid","Date","datetime","toLocaleString","initialMapState","lat","lng","zoom","CENTER","carIcon","L","icon","iconUrl","car","iconRetinaUrl","iconSize","iconAnchor","circleIcon","circle","truckIcon","truck","Icon","Default","imagePath","MapComponent","state","setMap","points","routes","center","lastPoints","forEach","el","console","log","limeOptions","color","polylines","Object","values","MapContainer","whenCreated","TileLayer","url","map","Marker","position","Popup","line","Polyline","pathOptions","positions","Aim","enable-background","height","viewBox","width","fill","xmlns","d","workerFunction","this","onmessage","data","wsConnection","WebSocket","onopen","postMessage","hint","onclose","event","wasClean","code","reason","evt","message","onerror","error","getPoints","setPoints","setRoutes","token","fetch","method","headers","then","response","json","coords","push","getRoutes","catch","err","AddPointComponent","callback","onSubmit","preventDefault","FormData","target","get","carId","alert","placeholder","name","TableRoutes","tableData","JSON","parse","stringify","reverse","Content","useState","useEffect","length","lastPoint","lastCoord","flyTo","socketMessageHandler","blob","Blob","replace","blobURL","window","URL","webkitURL","createObjectURL","myWorker","Worker","addThis","num1","num2","initWebSocket","query","body","res","addPoint","Auth","setError","login","password","ok","status","Error","result","loginFunc","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.17db7847.chunk.js","sourcesContent":["import React from 'react';\n// шапка страницы\nconst Header = ({setToken, route, setRoute}) => {\n\n    const menuHandler = (e) => {\n        const menuId = e.currentTarget.id;\n        setRoute(menuId);\n    };\n    return (\n        <div className=\"header\">\n            <div className=\"header__content\">\n                <div className=\"header__label\">Route Tracker</div>\n                <div className=\"header_menu\">\n                    <input\n                        type=\"button\"\n                        value=\"Map\"\n                        className=\"header__menu-el\"\n                        id=\"map\" \n                        onClick={menuHandler}\n                        style={{ textDecoration: route === 'map' ? 'underline' : 'none'}}\n                    />\n                    <input\n                        type=\"button\"\n                        value=\"Routes\"\n                        className=\"header__menu-el\"\n                        id=\"routes\" \n                        onClick={menuHandler}\n                        style={{ textDecoration: route === 'routes' ? 'underline' : 'none'}}\n                    />\n                </div>\n            </div>\n            <div><button className=\"header__logout\" onClick={() => setToken(false)}>Log out</button></div>\n        </div>\n    );\n}\n\nexport default Header;","import React, {useState} from 'react';\n\nconst Info = ({point}) => {\n\n    return (\n        <div>\n            <div>{`Vehicle Id: ${point.carid}`}</div>\n            <div>{`Date and time: ${new Date(point.datetime).toLocaleString()}`}</div>\n        </div>\n    )\n}\n\nexport default Info;","export default __webpack_public_path__ + \"static/media/car.6aa2874c.png\";","export default __webpack_public_path__ + \"static/media/truck.0edab585.png\";","export default __webpack_public_path__ + \"static/media/circle.249ec85b.svg\";","import L from 'leaflet';\nimport car from './icons/car.png';\nimport truck from './icons/truck.png';\nimport circle from './icons/circle.svg';\n\nexport const INITZOOM = 14;\n\nexport const  initialMapState = {\n    lat: 55.702868,\n    lng: 37.530865,\n    zoom: INITZOOM\n};\n\nexport const CENTER = [55.702868, 37.530865 ];\n\n\nexport const carIcon = L.icon({\n    iconUrl: car,\n    iconRetinaUrl: car,\n    iconSize: [18, 18],\n    iconAnchor: [9, 9]\n});\n\nexport const circleIcon = L.icon({\n    iconUrl: circle,\n    iconRetinaUrl: circle,\n    iconSize: [10, 10],\n    iconAnchor: [5, 5]\n});\n\nexport const truckIcon = L.icon({\n    iconUrl: truck,\n    iconRetinaUrl: truck,\n    iconSize: [18, 18],\n    iconAnchor: [9, 9]\n});","import React, {useState} from 'react';\nimport Info from './Info';\nimport { MapContainer, TileLayer, Marker, Popup, Polyline } from \"react-leaflet\";\nimport L from 'leaflet';\nimport './map.css';\nimport { carIcon, truckIcon, circleIcon } from '../consts';\n// указываем путь к файлам marker\nL.Icon.Default.imagePath = \"https://unpkg.com/leaflet@1.5.0/dist/images/\";\n\n\nconst MapComponent = ({state, setMap, points, routes}) => {\n    \n\n    const center = [state.lat, state.lng];\n\n    let lastPoints = {};\n    points.forEach(el => {\n        lastPoints[el.carid] = el;\n    });\n\n    console.log(lastPoints);\n\n    const limeOptions = { color: 'rgba(71,226,127,0.6)' }\n    const polylines = Object.values(routes);\n    return (\n        <MapContainer\n            zoom={state.zoom}\n            center={center}\n            whenCreated={setMap}\n        >\n            <TileLayer\n                url='https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png'\n            />\n            {\n                points.map(point => {\n                    return (\n                        <Marker position={[point.lat, point.lng]} key={point.datetime} icon={circleIcon}>\n                            <Popup>\n                                <Info point={point} />\n                            </Popup>\n                        </Marker>\n                    );\n                })\n            }\n            {\n                Object.values(lastPoints).map(point => {\n                    return (\n                        <Marker position={[point.lat, point.lng]} key={point.datetime + 'lastpoint'} icon={truckIcon}>\n                            <Popup>\n                                <Info point={point} />\n                            </Popup>\n                        </Marker>\n                    );\n                })\n            }\n            {\n                polylines.map(line => {\n                    return (\n                        <Polyline pathOptions={limeOptions} positions={line} key={line}/>\n                    );\n                })\n            }\n                <Marker position={[55.732868, 37.510865]} icon={carIcon}>\n                    <Popup>\n                        police\n                    </Popup>\n                </Marker>\n        </MapContainer>\n    );\n};\n\nexport default MapComponent;","\nimport React from 'react';\nconst Aim = () => {\n    return (\n        <svg\n            id=\"regular\"\n            enable-background=\"new 0 0 24 24\"\n            height=\"24\"\n            viewBox=\"0 0 24 24\"\n            width=\"24\"\n            fill=\"#6b7070\"\n            xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"m12 22c-5.514 0-10-4.486-10-10s4.486-10 10-10 10 4.486 10 10-4.486 10-10 10zm0-18.5c-4.687 0-8.5 3.813-8.5 8.5s3.813 8.5 8.5 8.5 8.5-3.813 8.5-8.5-3.813-8.5-8.5-8.5z\"/>\n                <path d=\"m12 5c-.414 0-.75-.336-.75-.75v-3.5c0-.414.336-.75.75-.75s.75.336.75.75v3.5c0 .414-.336.75-.75.75z\"/>\n                <path d=\"m23.25 12.75h-3.5c-.414 0-.75-.336-.75-.75s.336-.75.75-.75h3.5c.414 0 .75.336.75.75s-.336.75-.75.75z\"/>\n                <path d=\"m12 24c-.414 0-.75-.336-.75-.75v-3.5c0-.414.336-.75.75-.75s.75.336.75.75v3.5c0 .414-.336.75-.75.75z\"/>\n                <path d=\"m4.25 12.75h-3.5c-.414 0-.75-.336-.75-.75s.336-.75.75-.75h3.5c.414 0 .75.336.75.75s-.336.75-.75.75z\"/>\n                <path d=\"m12 15c-1.654 0-3-1.346-3-3s1.346-3 3-3 3 1.346 3 3-1.346 3-3 3zm0-4.5c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5 1.5-.673 1.5-1.5-.673-1.5-1.5-1.5z\"/>\n        </svg>\n    );\n};\nexport default Aim;","function workerFunction() {\n    var self = this;\n    self.onmessage = function({data}) {\n        const wsConnection = new WebSocket(\"ws://localhost:8888\");\n    \n        // web socket\n        wsConnection.onopen = function() {\n            postMessage({hint: 'Соединение установлено'});\n        };\n    \n        wsConnection.onclose = function(event) {\n            if (event.wasClean) {\n                postMessage({hint: 'Соединение закрыто чисто'});\n            } else {\n                // например, \"убит\" процесс сервера\n                postMessage({hint: 'Обрыв соединения'});\n            }\n            postMessage({hint: 'Код: ' + event.code + ' причина: ' + event.reason});\n        };\n    \n        wsConnection.onmessage = evt => {\n            // отправляем сообщение в основной поток\n            postMessage({message: evt.data});\n        }\n    \n        wsConnection.onerror = function(error) {\n            postMessage({error: \"Ошибка \" + error.message});\n        };\n    }\n}\n\nexport default workerFunction;\n\n\n\n\n\n","import workerFunction from '../serviceWorker';\n\n// authorisation function\nexport const loginFunc = (e, setToken, setError) => {\n    const data = new FormData(e.target);\n    const login = data.get('login');\n    const password = data.get('password');\n    console.log(login, password);\n    fetch('/api/authorization', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json;charset=utf-8'\n        },\n        body: JSON.stringify({ login, password }),\n    }).then(res => {\n        if (!res.ok) {\n            console.log(\"HTTP status \" + res.status);\n            throw Error;\n        }\n        return res.json();\n    }).then(result => {\n        setToken(result.token);\n        setError(false);\n    }).catch(err => {\n        setError(true);\n        console.log(err)\n    });\n};\n\n// get all routes\nconst getRoutes = (data) => {\n    const routes = {};\n    data.map(el => {\n        // coords for points\n        const coords = [el.lat, el.lng];\n        if (!routes[el.carid]) {\n            routes[el.carid] = [coords];\n        } else {\n            routes[el.carid].push(coords);\n        }\n    });\n    return routes;\n}\n// get all points\nexport const getPoints = (setPoints, setRoutes, token) => {\n    fetch('/api/get', {\n        method: 'GET',\n        headers: {'token': token}\n    }).then(response => response.json()).then(data => {\n        // разбиваем на отдельные маршруты по маг=шинам\n        const routes = getRoutes(data);\n        setPoints(data);\n        setRoutes(routes);\n    }).catch(err => console.log(err));\n}\n//send point to server\nexport const addPoint = (query, setPoints, token) => {\n    fetch('/api/addpoint', {\n        method: 'POST',\n        headers: {'token': token, 'Content-Type': 'application/json;charset=utf-8'},\n        body: JSON.stringify(query)\n    }).then(res => {\n        console.log('done');\n    }).catch(err => console.log(err));\n}\n\n// websocket initialisation with webworker\nexport const initWebSocket = (callback) => {\n    var dataObj = '(' + workerFunction + ')();'; // here is the trick to convert the above fucntion to string\n    var blob = new Blob([dataObj.replace('\"use strict\";', '')]); // firefox adds \"use strict\"; to any function which might block worker execution so knock it off\n\n    var blobURL = (window.URL ? window.URL : window.webkitURL).createObjectURL(blob, {\n        type: 'application/javascript; charset=utf-8'\n    });\n\n    const myWorker = new Worker(blobURL);\n    //const myWorker = new Worker('serviceWorker.js');\n    const message = { addThis: {num1: 1, num2: 10} };\n    myWorker.postMessage(message);\n    myWorker.onmessage = ({data}) => {\n        const {error, hint, message} = data;\n        if (error) {\n            alert(error);\n        }\n\n        if (message) {\n            console.log(message);\n            callback();\n        }\n    }\n};","import React from 'react';\n\n\n\nconst AddPointComponent = ({callback}) => {\n    const addPointHandler = (e) => {\n        e.preventDefault();\n        const data = new FormData(e.target);\n        const lat = data.get('lat');\n        const lng = data.get('lng');\n        const carId = data.get('uid');\n        if (!lng || !lat || !carId) {\n            alert('add all fields');\n            return;\n        }\n        callback({lat, lng, carId});\n    };\n\n    return (\n        <div className=\"map-menu\">\n            <form onSubmit={addPointHandler} className=\"addpoint-form\">\n                <label className=\"auth__label\">Uid</label>\n                <input className=\"auth__input\" type=\"text\" placeholder=\"1\" name=\"uid\"/>\n                <label className=\"auth__label\">Latitude</label>\n                <input className=\"auth__input\" type=\"text\" placeholder=\"55.712868\" name=\"lat\"/>\n                <label className=\"auth__label\">Longitude</label>\n                <input className=\"auth__input\" type=\"text\" placeholder=\"37.540865\" name=\"lng\"/>\n                <button type=\"submit\" className=\"auth__input auth_button\">Add</button>\n            </form>\n        </div>\n    )\n}\n\n\nexport default AddPointComponent;","import React from 'react';\n// шапка страницы\nconst TableRoutes = ({points}) => {\n    const tableData = JSON.parse(JSON.stringify(points)).reverse();\n    return (\n        <div className=\"table-container\">\n            <table>\n                <thead>\n                    <tr>\n                        <td>Vehicle Id</td>\n                        <td>Time</td>\n                        <td>Latitude</td>\n                        <td>Longitude</td>\n                    </tr>\n                </thead>\n                <tbody>\n                    {\n                        tableData.map(el => (\n                            <tr key={'table' + el.carid}>\n                                <td>{el.carid}</td>\n                                <td>{el.datetime}</td>\n                                <td>{el.lat}</td>\n                                <td>{el.lng}</td>\n                            </tr>\n                        ))\n                    }\n                </tbody>\n            </table>\n        </div>\n    );\n}\n\nexport default TableRoutes;","import React, {useEffect, useState } from 'react';\nimport MapComponent from './MapComponent';\nimport Aim from '../icons/aim'\nimport { addPoint, initWebSocket, getPoints } from '../services/service';\nimport { initialMapState, CENTER, INITZOOM } from '../consts';\nimport AddPointComponent from './AddpointComponent';\nimport TableRoutes from './TableRoutes';\n\n\n// содержания страницы\nconst Content = ({token, route}) => {\n    const [state, setState] = useState(initialMapState);\n    const [ map, setMap ] = useState(null);\n    const [points, setPoints] = useState([]);\n    const [routes, setRoutes] = useState({});\n\n    useEffect(() => {\n        getPoints(setPoints, setRoutes, token)\n    }, []);\n\n    useEffect(() => {\n        if (!points.length) {\n            return;\n        }\n        const lastPoint = points[points.length-1];\n        const lastCoord = [lastPoint.lat, lastPoint.lng];\n        map.flyTo(lastCoord, INITZOOM);\n    }, [points]);\n\n    const socketMessageHandler = () => {\n        getPoints(setPoints, setRoutes, token);\n    }\n    \n    // worker\n    useEffect(() => {\n        initWebSocket(socketMessageHandler);\n    }, []);\n\n    const goToCenter = () => {\n        map.flyTo(CENTER, INITZOOM);\n    }\n\n    const addPointHandler = (data) => {\n        addPoint(data, setPoints, token);\n    };\n    \n    return (\n        <div className=\"content\">\n            {\n                route === 'map' && (\n                    <>\n                        <AddPointComponent callback={addPointHandler} />\n                        <div className=\"center-menu\">\n                            <div><Aim/></div>\n                            <div>\n                                <button type=\"button\" className=\"auth__input auth_button\" onClick={goToCenter}>go</button>\n                            </div>\n                        </div>\n                        <div id=\"mapid\">\n                            <MapComponent state={state} setMap={setMap} points={points} routes={routes}/>\n                        </div>\n                    </>\n                )\n            }\n            { route !== 'map' && <TableRoutes points={points} />}\n        </div>\n    );\n}\n\nexport default Content;","// страница авторизации\nimport React, {useEffect, useState} from 'react';\nimport { loginFunc } from '../services/service';\n\nconst Auth = ({setToken}) => {\nconst [error, setError] = useState(false);\nconst submitHandler = (e) => {\n    e.preventDefault();\n    loginFunc(e, setToken, setError)\n};\n\nreturn(<div className=\"auth__container\">\n        <form className=\"auth__form\" onSubmit={submitHandler}>\n            <label className=\"auth__label\">Login</label>\n            <input className=\"auth__input\" type=\"text\" placeholder=\"login\" name=\"login\"/>\n            <label className=\"auth__label\">Password</label>\n            <input className=\"auth__input\" type=\"password\" placeholder=\"\" name=\"password\"/>\n            {error && <div className=\"auth_error\">Invalid login or password</div>}\n            <button type=\"submit\" className=\"auth__input auth_button\">Submit</button>\n        </form>\n    </div>);\n}\n\nexport default Auth;","import React, { useState } from 'react';\nimport Header from './components/Header';\nimport Content from './components/Content';\nimport Auth from './components/Auth';\n\n// компонент приложения\nconst App = () => {\n    const [token, setToken] = useState(null);\n    const [route, setRoute] = useState('map');\n    if (!token) {\n        return (<Auth setToken={setToken} />)\n    }\n    return(<div>\n            <Header setToken={setToken} route={route} setRoute={setRoute}/>\n            <Content token={token} route={route}/>\n        </div>);\n}\n\nexport default App;\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}