(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{17:function(e,t,n){},18:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),s=n(9),i=n.n(s),o=n(3),r=n(0),l=function(e){var t=e.setToken,n=e.route,c=e.setRoute,a=function(e){var t=e.currentTarget.id;c(t)};return Object(r.jsxs)("div",{className:"header",children:[Object(r.jsxs)("div",{className:"header__content",children:[Object(r.jsx)("div",{className:"header__label",children:"Route Tracker"}),Object(r.jsxs)("div",{className:"header_menu",children:[Object(r.jsx)("input",{type:"button",value:"Map",className:"header__menu-el",id:"map",onClick:a,style:{textDecoration:"map"===n?"underline":"none"}}),Object(r.jsx)("input",{type:"button",value:"Routes",className:"header__menu-el",id:"routes",onClick:a,style:{textDecoration:"routes"===n?"underline":"none"}})]})]}),Object(r.jsx)("div",{children:Object(r.jsx)("button",{className:"header__logout",onClick:function(){return t(!1)},children:"Log out"})})]})},u=function(e){var t=e.point;return Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{children:"Vehicle Id: ".concat(t.carid)}),Object(r.jsx)("div",{children:"Date and time: ".concat(new Date(t.datetime).toLocaleString())})]})},j=n(20),d=n(24),h=n(21),b=n(22),p=n(23),O=n(2),m=n.n(O),x=(n(17),n.p+"static/media/car.6aa2874c.png"),f=n.p+"static/media/truck.0edab585.png",g=n.p+"static/media/circle.249ec85b.svg",v={lat:55.702868,lng:37.530865,zoom:14},_=[55.702868,37.530865],w=m.a.icon({iconUrl:x,iconRetinaUrl:x,iconSize:[18,18],iconAnchor:[9,9]}),N=m.a.icon({iconUrl:g,iconRetinaUrl:g,iconSize:[10,10],iconAnchor:[5,5]}),y=m.a.icon({iconUrl:f,iconRetinaUrl:f,iconSize:[18,18],iconAnchor:[9,9]});m.a.Icon.Default.imagePath="https://unpkg.com/leaflet@1.5.0/dist/images/";var k=function(e){var t=e.state,n=e.setMap,c=e.points,a=e.routes,s=[t.lat,t.lng],i={};c.forEach((function(e){i[e.carid]=e})),console.log(i);var o={color:"rgba(71,226,127,0.6)"},l=Object.values(a);return Object(r.jsxs)(j.a,{zoom:t.zoom,center:s,whenCreated:n,children:[Object(r.jsx)(d.a,{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png"}),c.map((function(e){return Object(r.jsx)(h.a,{position:[e.lat,e.lng],icon:N,children:Object(r.jsx)(b.a,{children:Object(r.jsx)(u,{point:e})})},e.datetime)})),Object.values(i).map((function(e){return Object(r.jsx)(h.a,{position:[e.lat,e.lng],icon:y,children:Object(r.jsx)(b.a,{children:Object(r.jsx)(u,{point:e})})},e.datetime+"lastpoint")})),l.map((function(e){return Object(r.jsx)(p.a,{pathOptions:o,positions:e},e)})),Object(r.jsx)(h.a,{position:[55.732868,37.510865],icon:w,children:Object(r.jsx)(b.a,{children:"police"})})]})},S=function(){return Object(r.jsxs)("svg",{id:"regular","enable-background":"new 0 0 24 24",height:"24",viewBox:"0 0 24 24",width:"24",fill:"#6b7070",xmlns:"http://www.w3.org/2000/svg",children:[Object(r.jsx)("path",{d:"m12 22c-5.514 0-10-4.486-10-10s4.486-10 10-10 10 4.486 10 10-4.486 10-10 10zm0-18.5c-4.687 0-8.5 3.813-8.5 8.5s3.813 8.5 8.5 8.5 8.5-3.813 8.5-8.5-3.813-8.5-8.5-8.5z"}),Object(r.jsx)("path",{d:"m12 5c-.414 0-.75-.336-.75-.75v-3.5c0-.414.336-.75.75-.75s.75.336.75.75v3.5c0 .414-.336.75-.75.75z"}),Object(r.jsx)("path",{d:"m23.25 12.75h-3.5c-.414 0-.75-.336-.75-.75s.336-.75.75-.75h3.5c.414 0 .75.336.75.75s-.336.75-.75.75z"}),Object(r.jsx)("path",{d:"m12 24c-.414 0-.75-.336-.75-.75v-3.5c0-.414.336-.75.75-.75s.75.336.75.75v3.5c0 .414-.336.75-.75.75z"}),Object(r.jsx)("path",{d:"m4.25 12.75h-3.5c-.414 0-.75-.336-.75-.75s.336-.75.75-.75h3.5c.414 0 .75.336.75.75s-.336.75-.75.75z"}),Object(r.jsx)("path",{d:"m12 15c-1.654 0-3-1.346-3-3s1.346-3 3-3 3 1.346 3 3-1.346 3-3 3zm0-4.5c-.827 0-1.5.673-1.5 1.5s.673 1.5 1.5 1.5 1.5-.673 1.5-1.5-.673-1.5-1.5-1.5z"})]})};var T=function(){this.onmessage=function(e){e.data;var t=new WebSocket("ws://localhost:8888");t.onopen=function(){postMessage({hint:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e"})},t.onclose=function(e){e.wasClean?postMessage({hint:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e \u0447\u0438\u0441\u0442\u043e"}):postMessage({hint:"\u041e\u0431\u0440\u044b\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}),postMessage({hint:"\u041a\u043e\u0434: "+e.code+" \u043f\u0440\u0438\u0447\u0438\u043d\u0430: "+e.reason})},t.onmessage=function(e){postMessage({message:e.data})},t.onerror=function(e){postMessage({error:"\u041e\u0448\u0438\u0431\u043a\u0430 "+e.message})}}},z=function(e,t,n){fetch("/api/get",{method:"GET",headers:{token:n}}).then((function(e){return e.json()})).then((function(n){var c=function(e){var t={};return e.map((function(e){var n=[e.lat,e.lng];t[e.carid]?t[e.carid].push(n):t[e.carid]=[n]})),t}(n);e(n),t(c)})).catch((function(e){return console.log(e)}))},L=function(e){var t=e.callback;return Object(r.jsx)("div",{className:"map-menu",children:Object(r.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n=new FormData(e.target),c=n.get("lat"),a=n.get("lng"),s=n.get("uid");a&&c&&s?t({lat:c,lng:a,carId:s}):alert("add all fields")},className:"addpoint-form",children:[Object(r.jsx)("label",{className:"auth__label",children:"Uid"}),Object(r.jsx)("input",{className:"auth__input",type:"text",placeholder:"1",name:"uid"}),Object(r.jsx)("label",{className:"auth__label",children:"Latitude"}),Object(r.jsx)("input",{className:"auth__input",type:"text",placeholder:"55.712868",name:"lat"}),Object(r.jsx)("label",{className:"auth__label",children:"Longitude"}),Object(r.jsx)("input",{className:"auth__input",type:"text",placeholder:"37.540865",name:"lng"}),Object(r.jsx)("button",{type:"submit",className:"auth__input auth_button",children:"Add"})]})})},M=function(e){var t=e.points,n=JSON.parse(JSON.stringify(t)).reverse();return Object(r.jsx)("div",{className:"table-container",children:Object(r.jsxs)("table",{children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:"Vehicle Id"}),Object(r.jsx)("td",{children:"Time"}),Object(r.jsx)("td",{children:"Latitude"}),Object(r.jsx)("td",{children:"Longitude"})]})}),Object(r.jsx)("tbody",{children:n.map((function(e){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:e.carid}),Object(r.jsx)("td",{children:e.datetime}),Object(r.jsx)("td",{children:e.lat}),Object(r.jsx)("td",{children:e.lng})]},"table"+e.carid)}))})]})})},R=function(e){var t=e.token,n=e.route,a=Object(c.useState)(v),s=Object(o.a)(a,2),i=s[0],l=(s[1],Object(c.useState)(null)),u=Object(o.a)(l,2),j=u[0],d=u[1],h=Object(c.useState)([]),b=Object(o.a)(h,2),p=b[0],O=b[1],m=Object(c.useState)({}),x=Object(o.a)(m,2),f=x[0],g=x[1];Object(c.useEffect)((function(){z(O,g,t)}),[]),Object(c.useEffect)((function(){if(p.length){var e=p[p.length-1],t=[e.lat,e.lng];j.flyTo(t,14)}}),[p]);var w=function(){z(O,g,t)};Object(c.useEffect)((function(){!function(e){var t=new Blob([("("+T+")();").replace('"use strict";',"")]),n=(window.URL?window.URL:window.webkitURL).createObjectURL(t,{type:"application/javascript; charset=utf-8"}),c=new Worker(n);c.postMessage({addThis:{num1:1,num2:10}}),c.onmessage=function(t){var n=t.data,c=n.error,a=(n.hint,n.message);c&&alert(c),a&&(console.log(a),e())}}(w)}),[]);return Object(r.jsxs)("div",{className:"content",children:["map"===n&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(L,{callback:function(e){!function(e,t,n){fetch("/api/addpoint",{method:"POST",headers:{token:n,"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then((function(e){console.log("done")})).catch((function(e){return console.log(e)}))}(e,0,t)}}),Object(r.jsxs)("div",{className:"center-menu",children:[Object(r.jsx)("div",{children:Object(r.jsx)(S,{})}),Object(r.jsx)("div",{children:Object(r.jsx)("button",{type:"button",className:"auth__input auth_button",onClick:function(){j.flyTo(_,14)},children:"go"})})]}),Object(r.jsx)("div",{id:"mapid",children:Object(r.jsx)(k,{state:i,setMap:d,points:p,routes:f})})]}),"map"!==n&&Object(r.jsx)(M,{points:p})]})},U=function(e){var t=e.setToken,n=Object(c.useState)(!1),a=Object(o.a)(n,2),s=a[0],i=a[1];return Object(r.jsx)("div",{className:"auth__container",children:Object(r.jsxs)("form",{className:"auth__form",onSubmit:function(e){e.preventDefault(),function(e,t,n){var c=new FormData(e.target),a=c.get("login"),s=c.get("password");console.log(a,s),fetch("/api/authorization",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({login:a,password:s})}).then((function(e){if(!e.ok)throw console.log("HTTP status "+e.status),Error;return e.json()})).then((function(e){t(e.token),n(!1)})).catch((function(e){n(!0),console.log(e)}))}(e,t,i)},children:[Object(r.jsx)("label",{className:"auth__label",children:"Login"}),Object(r.jsx)("input",{className:"auth__input",type:"text",placeholder:"login",name:"login"}),Object(r.jsx)("label",{className:"auth__label",children:"Password"}),Object(r.jsx)("input",{className:"auth__input",type:"password",placeholder:"",name:"password"}),s&&Object(r.jsx)("div",{className:"auth_error",children:"Invalid login or password"}),Object(r.jsx)("button",{type:"submit",className:"auth__input auth_button",children:"Submit"})]})})},D=function(){var e=Object(c.useState)(null),t=Object(o.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)("map"),i=Object(o.a)(s,2),u=i[0],j=i[1];return n?Object(r.jsxs)("div",{children:[Object(r.jsx)(l,{setToken:a,route:u,setRoute:j}),Object(r.jsx)(R,{token:n,route:u})]}):Object(r.jsx)(U,{setToken:a})};i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(D,{})}),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.17db7847.chunk.js.map